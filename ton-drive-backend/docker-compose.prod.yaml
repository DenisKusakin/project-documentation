services:
  storage:
    build:
      dockerfile: ./Dockerfile.ton-storage
    volumes:
      - .docker-volumes/ton-storage-prod:/var/lib/ton-storage

  service:
    build:
      dockerfile: ./Dockerfile
    restart: always
    volumes:
      - .docker-volumes/ton-storage-prod/cli-keys:/var/lib/ton-storage/cli-keys
    environment:
      TON_STORAGE_HOST: storage
      TON_STORAGE_KEYS_DIR: /var/lib/ton-storage/cli-keys
    depends_on:
      - storage

  https-portal:
    image:  steveltn/https-portal:1
    ports:
        - "80:80"
        - "443:443"
    restart: always
    environment:
        # TODO: Replace localhost with your domain name or server IP
        DOMAINS:  "localhost -> http://service:3000"
        # STAGE: 'production' # Don't use production until staging works
        # FORCE_RENEW: 'true'
    depends_on:
        - service
